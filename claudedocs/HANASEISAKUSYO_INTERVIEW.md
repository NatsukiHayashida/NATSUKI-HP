# 花製作所プロジェクト インタビュー記録

## 📋 実施情報

- **実施日**: 2025-10-08
- **対象プロジェクト**: 花製作所サイト移行（EC-CUBE → Next.js + Supabase）
- **現在のステータス**: 計画段階（2025年内移行予定）

---

## ✅ 回答済み質問

### Q1: プロジェクト期間

**質問**: 実際の期間は？ 開始時期・完了時期を教えてください

**回答**:
- **2025年内の移行を予定**（現在計画・準備段階）
- 現行記載（2024年10月〜2025年1月）は仮の期間だった

**対応**: 実際の開始・完了日が確定次第、記事を更新

---

### Q2: 技術スタック

**質問**: 実際に使用する技術は？

**回答**:
- **確定している技術**:
  - Next.js
  - TypeScript
  - Tailwind CSS
  - Supabase
  - Stripe

- **検討中の技術**:
  - **tRPC** または **Drizzle**（最終決定待ち）

**対応**: 技術スタック欄に「検討中」の注釈追加、または確定後に更新

---

### Q3: デモURL

**質問**: このURLは正しいですか？

**回答**:
- **正しい**: `https://www.hanaseisakusyo.com/`

**対応**: 変更なし

---

### Q4: 移行前のシステム

**質問**: EC-CUBEを使っていたのは本当ですか？ EC-CUBEの問題点は記載内容で合っていますか？

**回答**:
- **本当**: 知識がない時に自分で作成したEC-CUBEサイト
- **運営体制**:
  - **ホスティング**: Xserver
  - **サポート**: ショップサービス料を支払い、運営サポートを受けている
  - **決済**: Stripe

**対応**: 運営体制の詳細を記事に追加

---

### Q5: 移行を決めた理由（最重要！）

**質問**: 記載内容以外に、移行のきっかけとなった出来事や理由はありますか？

**回答**:
**致命的な在庫管理バグが発生**

#### 🚨 発生した問題

**事象**:
- 商品をカートに入れ購入手続きに進んだ際、ほぼ同じタイミングで他のお客様が同じ商品を購入
- **決済だけが完了し、商品が届かないのに料金だけ引き落とされる**状態が発生
- お客様から連絡をいただいて判明

**発生件数**: 3件（すべて別々のお客様）

| 発生日 | 金額 | 内訳 | 対応状況 |
|--------|------|------|----------|
| 2024/07/31 | 5,160円 | 送料1,200円 + 商品3,960円 | ✅ 返金済み |
| 2024/08/31 | 4,500円 | 送料1,200円 + 商品3,300円 | ✅ 返金済み |
| 2024/09/30 | 10,770円 | 商品10,770円 | ⏳ 返金未対応（対応待ち） |

#### 📉 影響

- **信用問題**: ショップの信頼性に直結する重大な問題
- **金銭的損失**: 弊社負担で返金対応（合計20,430円 + 未対応分）
- **顧客満足度低下**: お客様からのクレーム対応

#### 🔍 原因分析（EC-CUBEの問題）

1. **在庫確保のタイミングが遅い**
   - 在庫チェックが決済後に行われる設計
   - 同時購入時に在庫ロックがかからない

2. **決済と在庫更新がトランザクション化されていない**
   - 決済成功後に在庫が不足していても、決済がキャンセルされない
   - DBレベルのトランザクション制御が不十分

3. **リアルタイム在庫管理の欠如**
   - 在庫数の同期が遅延
   - 複数ユーザーの同時アクセスに対応できない

#### 💡 技術的な対処案（EC-CUBE側）

以下の改善案が提示されたが、根本的な解決は困難と判断：

1. **在庫確保の前倒し**
   - カート投入時や購入手続き開始時に在庫を仮確保（ロック）
   - EC-CUBEのカスタマイズまたはプラグイン導入が必要

2. **決済前の在庫チェック強化**
   - OrderHelperなどの処理を改修し、決済リクエスト前に在庫数を再チェック
   - 少数在庫商品では必須

3. **決済と在庫更新のトランザクション化**
   - DBレベルで「在庫数更新」と「注文確定」をトランザクションでまとめる
   - 在庫不足時は決済処理自体をキャンセル

4. **プラグイン・設定の確認**
   - 決済プラグインが在庫チェックを「与信後」にしていないか確認
   - プラグインのアップデートや設定変更で改善可能か調査

#### 🎯 移行への決断

> **「そのたいくつかのトラブルもあり、自分で作成してもいいかなとおもっています。」**

**移行を決めた最大の理由**:
- EC-CUBEの根本的な設計問題を解決するには大規模なカスタマイズが必要
- モダンな技術スタック（Next.js + Supabase）でゼロから構築した方が確実
- 在庫管理をリアルタイムで正確に制御できる仕組みを実現
- 妻の運営負担を軽減し、信頼できるシステムを提供

**対応**: この在庫管理問題を記事の核心的な内容として大きく取り上げる

---

### Q6: データ移行 ✅

**質問**: 実際の商品数・顧客数は？データ移行の課題は？

**回答**:

#### 📊 実データ規模
- **会員数**: **2,658名**（記事記載の800件より大幅に多い）
- **取り扱った商品**: **4,306点**（記事記載の1,200件より大幅に多い）
- **商品の特性**: **一品もの**（在庫管理の重要性が極めて高い）

#### 🚨 最大の懸念：会員データ移行

**問題**:
- EC-CUBEから会員データ（2,658名）をどう移行するか？
- **再登録してもらう必要があるのか？**
- **スムーズに移行できるのか？**

**技術的な課題**:

1. **パスワード移行の問題**
   - EC-CUBEのパスワードハッシュ形式（bcrypt/sha256等）
   - Supabase Authのハッシュ形式との互換性
   - 再ハッシュが必要な場合、初回ログイン時にパスワードリセット要求？

2. **顧客データの整合性**
   - メールアドレス（必須、ユニーク制約）
   - 氏名、住所、電話番号
   - 購入履歴との紐付け

3. **認証システムの違い**
   - EC-CUBE独自認証 → Supabase Auth
   - セッション管理の移行

**対応方針（要検討）**:
- [ ] EC-CUBEからCSVエクスポート → Supabaseインポート（パスワードリセット必須）
- [ ] 段階的移行（旧システム併用期間を設ける）
- [ ] 初回ログイン時にパスワード再設定フロー

**対応**: データ移行戦略を記事に詳細記載 + 会員へのアナウンス計画

---

### Q7: パフォーマンス改善 ✅

**質問**: パフォーマンス目標は？

**回答**:

#### 🎯 パフォーマンス要件

**具体的な数値目標はなし**だが、以下の要件が重要：

**同時アクセス性能**:
> **「一度に大勢、200名程度がアクセスしても問題なく動く必要がある」**

**背景**:
- 商品販売時にアクセスが集中する
- 一品ものの性質上、販売開始直後に200名が同時アクセス
- この状況下でも在庫管理が正確に動作する必要がある

#### 📈 技術的な対策（実装予定）

1. **静的生成 + ISR**
   - Next.js App Routerで商品一覧を静的生成
   - 在庫情報だけリアルタイム取得

2. **Supabaseのスケーラビリティ**
   - PostgreSQLの同時接続数（デフォルト60接続）
   - Connection Pooling設定

3. **在庫ロック機構**
   - DBレベルのトランザクション制御
   - 楽観的ロック vs 悲観的ロック

4. **CDN + Edge Cache**
   - Vercel Edgeで静的コンテンツ配信
   - 画像最適化（商品画像4,306点）

**対応**: パフォーマンス要件として「同時200アクセス対応」を記事に明記

---

### Q8: 在庫管理の改善（最重要！）✅

**質問**: 新システムでは、在庫管理をどう改善する予定ですか？

**回答**:

#### 🤔 最大のジレンマ：在庫ロックのタイミング

**トレードオフの問題**:

1. **ロック時間が長すぎる場合**
   - カートに入れたまま購入しない → 一品ものが他のお客様に販売できない
   - 購入機会を阻む原因になる
   - ビジネス上の機会損失

2. **ロック時間が短すぎる（またはロックなし）場合**
   - 同じ商品を2名が同時購入する問題が再発
   - EC-CUBEと同じバグが発生

> **「ここは一番悩んでいます」**

#### 💡 検討すべき在庫管理戦略

**戦略A: 段階的ロック（推奨案）**

| フェーズ | アクション | ロック期間 | 解除条件 |
|---------|----------|----------|---------|
| ①カート投入 | **ソフトロック**（警告表示） | 5分 | タイムアウト or 明示的な削除 |
| ②購入手続き開始 | **ハードロック**（完全確保） | 10分 | 決済完了 or タイムアウト |
| ③決済処理中 | **トランザクションロック** | 決済完了まで | 成功 or 失敗 |

**メリット**:
- カート投入時は「仮予約」扱い（他ユーザーに「予約中」表示）
- 購入手続き開始で本格的にロック
- タイムアウトで自動解除 → 機会損失を最小化

**実装イメージ（Supabase）**:
```sql
-- 在庫テーブル
CREATE TABLE inventory (
  id UUID PRIMARY KEY,
  product_id UUID NOT NULL,
  status TEXT CHECK (status IN ('available', 'soft_locked', 'hard_locked', 'sold')),
  locked_by UUID REFERENCES users(id),
  locked_at TIMESTAMP,
  lock_expires_at TIMESTAMP
);

-- 自動解除（Supabase Edge Function + Cron）
-- 毎分実行し、expired lockを解除
```

---

**戦略B: 先着順 + リアルタイム通知**

- カート投入時は**ロックなし**
- 購入手続き（決済ボタン押下）時に**先着順で確定**
- Supabase Realtimeで「売り切れ」を即座に全ユーザーに通知

**メリット**:
- 機会損失なし（カートに入れても確保されない）
- 完全な先着順で公平

**デメリット**:
- 購入手続き中に「売り切れ」になる可能性
- ユーザー体験が悪化（決済直前に在庫切れ）

---

**戦略C: 購入意思確認ダイアログ**

- カート投入時に確認モーダル表示
  - 「この商品は一点ものです。5分以内に購入手続きを完了してください」
- 「確認」クリックで5分間のハードロック
- タイムアウト時に明示的な通知

**メリット**:
- ユーザーに購入意思を確認
- 冷やかし防止

**デメリット**:
- UXが煩雑になる可能性

---

#### 🎯 推奨アプローチ（技術的ベストプラクティス）

**段階的ロック（戦略A）+ リアルタイム通知**の組み合わせ：

1. **カート投入時（ソフトロック）**
   ```typescript
   // 5分間の仮予約
   await supabase.from('inventory').update({
     status: 'soft_locked',
     locked_by: userId,
     lock_expires_at: new Date(Date.now() + 5 * 60 * 1000)
   }).eq('id', inventoryId)

   // 他のユーザーには「予約中（あと○分で解除）」と表示
   ```

2. **購入手続き開始時（ハードロック）**
   ```typescript
   // 10分間の本確保
   await supabase.from('inventory').update({
     status: 'hard_locked',
     lock_expires_at: new Date(Date.now() + 10 * 60 * 1000)
   }).eq('id', inventoryId).eq('locked_by', userId)
   ```

3. **決済時（トランザクション）**
   ```typescript
   // PostgreSQL トランザクション
   await supabase.rpc('complete_purchase', {
     inventory_id: inventoryId,
     user_id: userId,
     payment_intent_id: stripePaymentIntent
   })
   ```

4. **タイムアウト自動解除（Supabase Edge Function）**
   ```typescript
   // 毎分実行
   supabase.from('inventory')
     .update({ status: 'available', locked_by: null })
     .lt('lock_expires_at', new Date())
     .in('status', ['soft_locked', 'hard_locked'])
   ```

5. **リアルタイム通知（Supabase Realtime）**
   ```typescript
   // クライアント側
   supabase
     .channel('inventory_changes')
     .on('postgres_changes', {
       event: 'UPDATE',
       schema: 'public',
       table: 'inventory'
     }, (payload) => {
       // 在庫状態変更を即座に反映
       updateUI(payload.new)
     })
     .subscribe()
   ```

#### ⚖️ タイムアウト時間の推奨値

| ロック種別 | 推奨時間 | 理由 |
|----------|---------|------|
| ソフトロック（カート） | **3-5分** | 商品詳細確認 + 購入判断に十分 |
| ハードロック（購入手続き） | **10-15分** | 住所入力 + 決済情報入力に必要 |
| トランザクションロック | **30-60秒** | Stripe決済完了まで |

#### 🛍️ 現在の販売フロー（重要！）

**実際の運用方法**:

1. **事前告知（Instagram）**
   - 「○月○日 9:00に商品追加」を告知
   - お客様がスタンバイ

2. **メンテナンス（販売1時間前 = 8:00）**
   - サイトをメンテナンス状態にしてアクセス不可
   - 商品登録作業

3. **販売開始（9:00）**
   - サイトを一斉オープン
   - **200名が同時アクセス**
   - **30商品程度が取り合いになる**

4. **集中購入（9:00-10:00の1時間）**
   - ほぼこの1時間でほとんどが売り切れ
   - 一品もの × 少数 × 人気 = 超高速販売

**販売頻度**: **月2回程度**（月約60商品の新規追加）

#### 🚨 このフローでの技術的課題

**問題1: 販売開始時の同時アクセス（200名）**
- 9:00ジャストに200名が一斉アクセス
- DBコネクション・サーバー負荷のピーク

**問題2: 在庫の取り合い（30商品 ÷ 200名）**
- 同じ商品に複数人が同時にアクセス
- 在庫ロックが正確に動作しないと重複購入発生

**問題3: カート放置の影響が大きい**
- 30商品しかない中で、カート放置 = 大きな機会損失
- 5分のロックでも、30商品 × 5分 = 最悪150分の機会損失

#### 💡 販売フローに最適化した在庫管理戦略

**改訂案: 短時間ロック + 積極的な解放**

| フェーズ | ロック時間 | 理由 |
|---------|----------|------|
| カート投入 | **2分** | 商品数が少ないため短く設定 |
| 購入手続き開始 | **5分** | 住所・決済情報入力に最低限必要 |
| 決済処理中 | 30-60秒 | Stripe決済完了まで |

**追加施策**:

1. **カート投入時に警告表示**
   ```
   ⚠️ この商品は一点ものです
   📍 2分以内に購入手続きを開始してください
   ⏱️ 残り時間: 1分30秒
   ```

2. **「今すぐ購入」ボタンの強調**
   - カート投入と購入手続きを統合
   - Amazon的な「1-Click購入」に近いUX

3. **リアルタイム在庫表示**
   ```
   🔴 残り1点（3名が閲覧中）
   ⏳ 2名が購入手続き中
   ```

4. **販売開始前の「お気に入り」機能**
   - 8:00-9:00のメンテナンス中に商品プレビュー
   - お気に入り登録しておくと、9:00に優先的にカート投入通知

5. **段階的オープン（検討）**
   - 9:00:00 - 会員優先
   - 9:00:30 - 一般開放
   - アクセス分散で負荷軽減

#### 📊 AB テストの検討

移行後に以下をテスト：
- ソフトロック時間: 2分 vs 3分 vs 5分
- 「今すぐ購入」ボタンの効果
- ユーザー離脱率
- 機会損失率
- 重複購入発生率
- サーバー負荷（9:00-10:00）

**対応**:
- 在庫管理戦略を記事の技術的解決策として詳細に記載
- 実際の販売フローを記事に追加（Instagram告知 → メンテナンス → 一斉販売）
- 「30商品を200名が取り合う」というビジネス特性を強調

---

### Q9: ビジネス目標 ✅

**質問**: 移行後に達成したい具体的な目標は？

**回答**:

#### 🎯 最優先目標

**1. 購入トラブルの削減**
- 重複購入（在庫バグ）の完全防止
- システムエラーによる決済トラブルの削減
- 顧客からの問い合わせ・クレーム対応の削減

**2. 高齢者向けUX（重要！）**

**顧客特性**:
> **「客層が40~60代の方が多く、スマホやPCの煩雑な操作が苦手意識の高い方も多い」**

**必要なUX改善**:
- シンプルで直感的な操作フロー
- 大きなボタン・読みやすいフォント
- 不要なステップの削減
- エラーメッセージの分かりやすさ
- 「今すぐ購入」など、ワンクリックでの購入体験

**技術的な対策**:
```typescript
// 高齢者向けUX設計
- フォントサイズ: 16px以上（PC）、18px以上（スマホ）
- ボタンサイズ: 最低44px × 44px（タップしやすい）
- カラーコントラスト: WCAG AA準拠
- 入力フォーム: 自動補完・郵便番号→住所自動入力
- エラー表示: 赤字 + アイコン + 具体的な修正方法
```

#### 📦 運用工数の改善

**現状の配送作業**:
- ゆうパックで配送
- 包装・梱包作業
- **手書きでお手紙・お礼を同封**（温かみのある対応）

**簡素化が必要な作業**:
- [ ] 配送ラベルの自動印刷（ゆうパックAPI連携？）
- [ ] 注文情報の自動集計
- [ ] 在庫管理の自動化
- [ ] 売上レポートの自動生成

**維持すべき温かみ**:
- ✅ 手書きのお手紙・お礼（これは継続）
- ✅ 丁寧な梱包

**対応**:
- 高齢者向けUXをデザイン方針の中核に
- 配送業務の効率化機能を検討（ゆうパックAPI等）
- 「人の温かみ」と「システム効率化」の両立を記事で強調

---

### Q10: コスト目標 ✅

**質問**: 現在のコストと移行後の目標コストは？

**回答**:

#### 💰 コスト目標

**移行後の目標**:
> **「サーバー、ドメイン等、通信費を年間10万円程度に抑えたい」**
> ※Stripe手数料は除く

**年間10万円 = 月額約8,333円**

#### 💡 想定される費用構成

**新システム（Next.js + Supabase）の場合**:

| 項目 | サービス | 月額コスト | 年間コスト |
|------|---------|-----------|-----------|
| ホスティング | Vercel Pro | $20 (約3,000円) | 約36,000円 |
| データベース | Supabase Pro | $25 (約3,750円) | 約45,000円 |
| ドメイン | お名前.com等 | 約100円 | 約1,200円 |
| **合計** | - | **約6,850円/月** | **約82,200円/年** |

**✅ 目標10万円以内に収まる見込み**

#### 📊 コスト比較（EC-CUBE vs 新システム）

**現行システム（EC-CUBE + Xserver）**:
- Xserver: 月額 ○○円（要確認）
- ショップサービス料: 月額 ○○円（要確認）
- 合計: 月額 ○○円

**新システム（Next.js + Supabase）**:
- 月額: 約6,850円（目標10万円/年以内）
- Stripe手数料: 3.6%（決済金額に応じて変動、現行と同じ）

#### 🎯 コスト削減のポイント

1. **Vercel Proが必要な理由**
   - 商用利用（Hobbyプランは非商用のみ）
   - 同時アクセス200名に対応
   - Edge FunctionsとISRの利用
   - チーム機能（奥様との共同運用）

2. **Supabase Proが必要な理由**
   - データベース容量（商品4,306点 + 会員2,658名）
   - 同時接続数（60接続以上）
   - 自動バックアップ
   - 優先サポート

3. **さらなるコスト削減案（検討）**
   - Supabase Freeプラン（$0）から開始
     - 制限: 500MB DB容量、60同時接続
     - 様子を見てProへアップグレード
   - Vercel Hobbyプラン検討の余地
     - 個人事業主の場合はグレーゾーン

**対応**:
- コスト目標「年間10万円以内」を記事に明記
- 現行システムとの費用比較表を作成
- Stripe手数料は別計算であることを明示

---

### Q11: 優先機能 ✅

**質問**: 移行後に最優先で実装したい機能は？

**回答**:

#### 📊 管理ダッシュボード（最優先・必須機能）

> **「管理するのに、ダッシュボードは必要です。それがないと、誰も扱えない」**

**必須要件**:
- **現行システム（EC-CUBE）と遜色ないこと**
- 奥様が使いやすいこと（非エンジニアが直感的に操作可能）

#### 📈 必要なレポート機能

**1. 日次レポート**
- [ ] 当日の売上合計
- [ ] 当日の注文件数
- [ ] 当日の新規会員登録数
- [ ] 人気商品ランキング（当日）

**2. 月間レポート**
- [ ] 月間売上推移（グラフ）
- [ ] 月間注文件数
- [ ] 月間新規会員数
- [ ] 商品カテゴリ別売上
- [ ] 販売イベント別実績（月2回の販売）

**3. 年間レポート**
- [ ] 年間売上推移
- [ ] 年間注文件数
- [ ] 会員数推移
- [ ] 年間人気商品TOP10

**4. リアルタイムダッシュボード**
- [ ] 現在の注文状況（未処理/処理中/完了）
- [ ] 在庫状況（販売可能/予約中/売切）
- [ ] 現在の閲覧者数（販売開始時に重要）
- [ ] 直近の注文一覧

#### 🛠️ 管理機能（運用に必須）

**商品管理**:
- [ ] 商品登録（画像アップロード、説明文入力）
- [ ] 商品編集・削除
- [ ] 在庫状態管理（販売中/販売停止）
- [ ] 一括商品登録（CSV インポート）

**注文管理**:
- [ ] 注文一覧・検索
- [ ] 注文詳細表示（顧客情報、配送先、商品）
- [ ] 配送ステータス更新（未発送/発送済み/配達完了）
- [ ] 配送ラベル印刷（ゆうパック連携）

**顧客管理**:
- [ ] 会員一覧・検索
- [ ] 会員詳細（購入履歴、お気に入り）
- [ ] 会員へのメール送信（販売告知等）

**設定管理**:
- [ ] 送料設定
- [ ] 決済設定（Stripe連携確認）
- [ ] メンテナンスモード切替（販売開始前の準備）

#### 💡 実装アプローチ（技術的提案）

**Option A: Next.js Admin Dashboard（カスタム開発）**

```typescript
// app/admin/dashboard/page.tsx
export default async function AdminDashboard() {
  const stats = await getStats() // 日次・月次・年次の集計

  return (
    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
      {/* 今日の売上 */}
      <StatCard
        title="今日の売上"
        value={stats.today.revenue}
        icon={<DollarSign />}
      />
      {/* 今月の注文数 */}
      <StatCard
        title="今月の注文"
        value={stats.month.orders}
        icon={<ShoppingCart />}
      />
      {/* 年間会員数 */}
      <StatCard
        title="会員数"
        value={stats.year.members}
        icon={<Users />}
      />
    </div>
  )
}
```

**メリット**:
- 完全なカスタマイズ可能
- Next.js App Routerと統合
- EC-CUBEの機能を完全再現可能

**デメリット**:
- 開発工数が大きい（3-4週間程度）

---

**Option B: React Admin（OSSライブラリ活用）**

[React Admin](https://marmelab.com/react-admin/)を使用

```typescript
import { Admin, Resource, ListGuesser } from 'react-admin'
import { supabaseDataProvider } from './supabaseDataProvider'

export default function AdminApp() {
  return (
    <Admin dataProvider={supabaseDataProvider}>
      <Resource name="orders" list={OrderList} />
      <Resource name="products" list={ProductList} />
      <Resource name="customers" list={CustomerList} />
    </Admin>
  )
}
```

**メリット**:
- 短期間で実装可能（1-2週間）
- CRUD機能が自動生成
- データグリッド・検索・フィルタが標準装備

**デメリット**:
- デザインのカスタマイズに制約
- React Adminの学習コストが必要

---

**Option C: Retool / Appsmith（ノーコード管理画面）**

[Retool](https://retool.com/) / [Appsmith](https://www.appsmith.com/)

**メリット**:
- コーディング不要（ドラッグ&ドロップ）
- Supabaseと直接連携可能
- 最速で構築（数日）

**デメリット**:
- 月額コスト（Retool: $10-50/月）
- カスタマイズの限界

---

#### 🎯 推奨アプローチ

**フェーズ1: MVP（最速リリース）**
- React Adminで基本機能を実装（1-2週間）
- 日次・月次・年次レポート
- 商品管理・注文管理

**フェーズ2: カスタマイズ（運用開始後）**
- 使いづらい部分をカスタムダッシュボードに置き換え
- EC-CUBEとの比較で不足機能を追加

**対応**:
- 管理ダッシュボードを最優先機能として記事に明記
- EC-CUBE管理画面のスクリーンショットを参考に機能要件を洗い出し
- 「現行と遜色ない」ことを品質基準として設定

---

### Q12 & Q13: プロジェクトで伝えたいこと ✅

**質問**: このプロジェクトで一番伝えたいことは？ポートフォリオとしての位置づけは？

**回答**:

#### 🎯 核心的なメッセージ

> **「ClaudeやChatGPTに手伝ってもらいながら、モダンで堅牢なシステムを自分が作成するアプローチ」**

#### 💡 これが意味すること

**1. AI時代のエンジニアリング手法**
- すべてを一人で完璧に理解する必要はない
- AI（Claude、ChatGPT）を**開発パートナー**として活用
- 重要なのは**何を作るべきか判断する力**と**最終的な品質責任**

**2. 実践的な問題解決**
- 理論的な学習ではなく、**実際のビジネス課題**を解決
- EC-CUBEの致命的バグ → モダンスタックで根本解決
- 妻のビジネスを支える**実用的なシステム**

**3. モダン技術スタックの実装**
- Next.js 14 + App Router
- Supabase（PostgreSQL + Realtime + Auth）
- TypeScript、Tailwind CSS
- Stripe決済統合
- **最新技術を実際のプロダクションで運用**

**4. 堅牢性へのこだわり**
- 在庫管理の完全性（トランザクション制御）
- 同時200アクセス対応（負荷テスト）
- 会員データ2,658名の安全な移行
- **本番運用に耐える品質**

#### 📊 ポートフォリオとしての価値

**このプロジェクトが証明すること**:

| 観点 | 証明できるスキル |
|------|----------------|
| **問題発見** | EC-CUBEの設計上の問題を技術的に分析・理解 |
| **意思決定** | リビルド vs 改修の判断、技術選定の根拠 |
| **設計力** | 在庫管理ロジック、段階的ロック、リアルタイム同期 |
| **実装力** | フロントエンド + バックエンド + 管理画面の一貫開発 |
| **品質管理** | 負荷テスト、トランザクション整合性、データ移行戦略 |
| **ビジネス理解** | 高齢者UX、運用効率化、コスト最適化 |
| **AI活用** | Claude/ChatGPTとの協働開発手法 |

#### ✨ ストーリーの軸

```
【問題】
EC-CUBEで3件の重複購入バグ発生
→ お客様に商品が届かず、返金対応（信用問題）

【原因分析】
在庫確保タイミングが遅い + トランザクション制御の欠如
→ EC-CUBEの根本的な設計問題

【決断】
大規模カスタマイズ vs ゼロから構築
→ モダン技術スタックでリビルドを選択

【実装】
Claude/ChatGPTを開発パートナーとして活用
→ 段階的ロック、リアルタイム在庫管理を実装

【成果】
- 在庫トラブルゼロ
- 同時200アクセス対応
- 高齢者にも使いやすいUX
- 年間コスト10万円以内
- 奥様の運用負担軽減
```

#### 🎤 想定される質問と回答

**Q: なぜEC-CUBEをカスタマイズしなかったのですか？**
> A: 在庫管理の根本的な設計問題を解決するには大規模なカスタマイズが必要で、モダンスタックでゼロから構築した方が確実かつ保守性が高いと判断しました。

**Q: AIツールをどう活用しましたか？**
> A: Claudeには設計レビュー、コード生成、バグ解析を依頼し、ChatGPTには技術選定の相談やドキュメント作成を手伝ってもらいました。最終的な判断と品質責任は自分が持ちました。

**Q: 最も苦労した点は？**
> A: 会員2,658名のパスワードハッシュ移行と、在庫ロックのタイムアウト時間調整です。実際の運用データで何度もテストしました。

**Q: 移行後の改善効果は？**
> A: 在庫トラブルがゼロになり、奥様の運用工数が週5時間削減されました。お客様からの問い合わせも大幅に減少しています。（※実装後の実績値）

#### 🏆 このプロジェクトが示す価値

**採用担当者への訴求ポイント**:

1. **実務レベルの問題解決能力**
   - 教科書的な知識ではなく、実際のビジネス課題を解決
   - 制約条件（コスト、納期、技術的負債）の中での最適解

2. **AI時代の開発手法**
   - AI支援を前提とした開発プロセス
   - 人間の判断力 × AIの生産性 = 高速・高品質開発

3. **フルスタック開発力**
   - EC全体（商品、在庫、決済、会員、管理画面）を一貫して設計・実装
   - フロントエンド、バックエンド、インフラの全レイヤー

4. **ユーザー中心設計**
   - 高齢者UXへの配慮
   - 非エンジニア（奥様）が使える管理画面
   - ビジネス要件を技術実装に落とし込む力

**対応**:
- 記事のタイトル案：「AIと協働で作る堅牢なECサイト：EC-CUBEからNext.js+Supabaseへの移行物語」
- 冒頭で「在庫バグによる3件の返金トラブル」を強調
- 中盤で「技術選定の判断プロセス」と「AI活用手法」を詳述
- 終盤で「実装の工夫」と「移行後の成果」を具体的に記載
- 全体を通して「実践的な問題解決ストーリー」として構成

---

## 🔧 技術選定について（補足確認）

---

## 🔧 技術選定について（補足質問）

**tRPC vs REST API**
- tRPCを検討している理由は？型安全性？
- Next.js App Router + Server Actionsは検討しましたか？

**Drizzle vs Prisma**
- Drizzle を検討している理由は？（軽量？Supabase相性？）
- それともSupabaseのクライアントライブラリのみ？

---

## 📝 記事更新の方針

### 強調すべきポイント

1. **在庫管理の致命的なバグ** → 記事の冒頭で大きく取り上げる
2. **実際に発生した3件のトラブル** → 具体的な金額と対応状況を記載
3. **EC-CUBEの限界** → 技術的な問題点を明確に説明
4. **移行の決断** → 「自分で作成した方が確実」という判断の背景

### 修正が必要な箇所

1. **プロジェクト期間**: 2025年内移行予定に変更
2. **技術スタック**: tRPC/Drizzle検討中の注釈追加
3. **背景・課題**: 在庫管理バグを最優先で記載
4. **成果・KPI**: 移行後の目標値に変更（実績値ではない）

---

---

## 📋 インタビュー完了サマリー

### ✅ 収集できた全情報

#### 🎯 プロジェクト基本情報
- **期間**: 2025年内移行予定（現在計画・準備段階）
- **技術スタック**: Next.js 14, TypeScript, Tailwind CSS, Supabase, Stripe
- **検討中**: tRPC または Drizzle（最終決定待ち）
- **デモURL**: https://www.hanaseisakusyo.com/

#### 🚨 移行の核心的理由
- **致命的な在庫バグ**: 3件発生、合計20,430円の返金対応
- **EC-CUBEの根本的問題**: トランザクション制御の欠如
- **信用問題**: 「商品が届かないのに課金」という最悪のUX

#### 📊 データ規模
- **会員数**: 2,658名（記事の800名は誤り）
- **取り扱い商品**: 4,306点（記事の1,200点は誤り）
- **商品特性**: すべて一品もの（在庫管理精度が最重要）

#### 🛍️ 販売フロー
- **頻度**: 月2回（年24回）
- **1回あたり**: 30商品を200名が取り合う
- **販売時間**: 9:00-10:00の1時間で完売
- **告知方法**: Instagram → メンテナンス（8:00-9:00） → 一斉販売

#### 🎯 ビジネス目標
1. **購入トラブル削減**（在庫バグの完全防止）
2. **高齢者向けUX**（40-60代、PC・スマホ操作が苦手）
3. **運用効率化**（奥様の作業負担軽減、手書きお礼状は継続）
4. **コスト目標**: 年間10万円以内（月約8,333円）

#### 🔧 最優先機能
- **管理ダッシュボード**（日次・月次・年次レポート）
- **現行EC-CUBEと遜色ない機能**（誰も扱えないと困る）
- 商品管理、注文管理、顧客管理、配送ラベル印刷

#### 💡 核心的メッセージ
> 「ClaudeやChatGPTに手伝ってもらいながら、モダンで堅牢なシステムを自分が作成するアプローチ」

- AI時代のエンジニアリング手法
- 実践的な問題解決（ビジネス課題の解決）
- モダン技術スタックの実装
- 堅牢性へのこだわり

---

## 📝 次のアクション

### 1. プロジェクト記事の全面更新

**ファイル**: `content/projects/hanaseisakusyo-rebuild.mdx`

**更新内容**:
- [ ] タイトル更新：「AIと協働で作る堅牢なECサイト：EC-CUBEからNext.js+Supabaseへの移行物語」
- [ ] データ規模修正：会員2,658名、商品4,306点
- [ ] プロジェクト期間：2025年内移行予定
- [ ] 在庫バグの詳細を冒頭で強調（3件、20,430円の返金）
- [ ] 販売フローの追加（月2回、200名同時、30商品取り合い）
- [ ] 高齢者向けUXの重要性を追加
- [ ] 管理ダッシュボードを最優先機能として明記
- [ ] AI活用手法の詳述
- [ ] コスト目標（年間10万円以内）を明記

### 2. 技術選定の最終確認

**未決定事項**:
- [ ] tRPC vs REST API vs Server Actions
- [ ] Drizzle vs Prisma vs Supabase Client のみ

### 3. 他プロジェクトのインタビュー

- [ ] Savybotプロジェクト
- [ ] Hobbyプロジェクト（該当する場合）

---

**記録日**: 2025-10-08
**インタビュー完了日**: 2025-10-09
**次回更新予定**: プロジェクト記事の全面更新後
