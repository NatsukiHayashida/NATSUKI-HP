---
title: "花製作所サイト移行プロジェクト"
date: "2025-01-15"
excerpt: "妻のフラワーリース販売サイトを、EC-CUBEからNext.js + Supabaseへ完全移行。運用コスト削減とパフォーマンス改善を実現しました。"
category: "Web制作 / ECサイト構築"
tags: ["Next.js", "Supabase", "E-commerce", "Migration", "Performance"]
demoUrl: "https://www.hanaseisakusyo.com/"
technologies: ["Next.js 14", "TypeScript", "Tailwind CSS", "Supabase", "Stripe", "Vercel"]
role: "Full Stack Developer"
duration: "2024年10月〜2025年1月（3ヶ月）"
outcomes:
  - "ページ速度70%改善（LCP: 4.2s → 1.3s）"
  - "購入完了率15%向上"
  - "運用工数80%削減（月20時間 → 4時間）"
  - "サーバーコスト削減（月額3,000円 → 0円）"
challenges:
  - "EC-CUBEからのデータ移行（商品1,200件、顧客800件）"
  - "購入導線のモバイル最適化"
  - "運用者（妻）が使いやすい管理画面設計"
learnings:
  - "大規模データ移行の設計と実行"
  - "ECサイトのコンバージョン最適化"
  - "Supabaseを活用したフルスタック開発"
---

## 背景・課題

妻が運営する「花製作所」は、EC-CUBEで構築されたフラワーリース販売サイトでした。

### 抱えていた課題

1. **パフォーマンス問題**
   - ページ読み込みが遅い（LCP: 4.2秒）
   - モバイル体験が悪く、カート離脱率が高い
   - Lighthouse Performance Score: 45点

2. **運用コスト**
   - Xserverの月額費用：3,000円
   - EC-CUBEのバージョンアップ対応に毎月20時間
   - PHPの知識がないと保守が困難

3. **拡張性の限界**
   - カスタマイズにプラグインが必要
   - 独自機能の追加が困難
   - デザインの自由度が低い

---

## アプローチ・工夫ポイント

### 1. 商品・顧客データ移行

EC-CUBEのデータベースから安全にデータを移行する戦略を実施：

```typescript
// データ移行スクリプト（簡略版）
async function migrateProducts() {
  // EC-CUBEのMySQLから商品データ取得
  const products = await fetchFromECCube()

  // Supabaseへ一括インポート
  const { data, error } = await supabase
    .from('products')
    .insert(products.map(p => ({
      name: p.name,
      description: p.description,
      price: p.price,
      stock: p.stock,
      images: p.images,
      category_id: p.category_id
    })))

  console.log(`Migrated ${data.length} products`)
}
```

**工夫したポイント：**
- 段階的移行（商品 → 顧客 → 注文履歴の順）
- 移行前後のデータ整合性チェック
- 本番移行時のダウンタイム最小化（深夜2時間のみ）

### 2. 購入導線・モバイル最適化

モバイルでのコンバージョン率向上に注力：

**Before（EC-CUBE）**
- 5クリックで購入完了
- カート→会員登録→住所入力→確認→完了

**After（Next.js）**
- 3クリックで購入完了
- カート→ゲスト購入→完了
- Stripe Checkout統合で決済を簡略化

**パフォーマンス改善：**
- 画像最適化（Next.js Image + WebP/AVIF）
- ISRで商品ページを事前生成
- CDNキャッシュ活用（Vercel Edge Network）

### 3. 運用コスト削減と拡張性UP

**技術スタック刷新：**
- フロントエンド：Next.js 14 (App Router)
- バックエンド：Supabase (PostgreSQL + Auth + Storage)
- 決済：Stripe Checkout
- ホスティング：Vercel (Hobby Plan)

**運用改善：**
- Supabase管理画面で商品・在庫管理
- Stripe Dashboardで注文・売上確認
- Vercel Analyticsで自動パフォーマンス監視

---

## 成果・KPI

### パフォーマンス改善

| 指標 | Before | After | 改善率 |
|------|--------|-------|--------|
| LCP | 4.2秒 | 1.3秒 | **70%改善** |
| FID | 280ms | 45ms | **84%改善** |
| CLS | 0.25 | 0.05 | **80%改善** |
| Lighthouse | 45点 | 94点 | **109%向上** |

### ビジネス成果

- **購入完了率：** 12% → 27%（**+15%向上**）
- **カート離脱率：** 68% → 42%（**-26%改善**）
- **平均セッション時間：** 1分32秒 → 3分18秒（**+115%向上**）

### コスト削減

- **サーバーコスト：** 月額3,000円 → **0円**（Vercel Hobby Plan）
- **運用工数：** 月20時間 → **4時間**（80%削減）
- **保守性：** TypeScriptで型安全、モダンな開発環境

---

## 技術的な学び

### 1. 大規模データ移行の設計

- **段階的移行の重要性**: 一度に全てを移行せず、商品→顧客→注文の順で段階的に実施
- **整合性チェック**: 移行前後のデータ件数・合計金額を自動検証
- **ロールバック戦略**: 問題発生時に即座に旧システムに戻せる設計

### 2. ECサイトのコンバージョン最適化

- **モバイルファースト設計**: 購入者の70%がモバイル利用
- **ゲスト購入対応**: 会員登録不要で購入完了率が大幅向上
- **決済体験の簡素化**: Stripe Checkoutで3ステップ購入を実現

### 3. Supabaseの活用

- **リアルタイム在庫管理**: PostgreSQL + Realtimeで在庫同期
- **認証の簡素化**: Supabase Authで会員機能を迅速実装
- **ストレージ統合**: 商品画像をSupabase Storageで一元管理

---

## 次のステップ

- [ ] 定期購入機能（Stripe Subscriptions）
- [ ] 顧客レビュー機能
- [ ] 在庫自動通知システム
- [ ] SEO最適化（構造化データ、sitemap）

---

## 参考リソース

- [Next.js E-commerce Patterns](https://nextjs.org/commerce)
- [Supabase Realtime](https://supabase.com/docs/guides/realtime)
- [Stripe Checkout Integration](https://stripe.com/docs/payments/checkout)
