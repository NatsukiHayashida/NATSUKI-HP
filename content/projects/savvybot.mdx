---
title: "SavvyBoté€²åŒ–ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ - LINEãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã‚’ã€Œã™ã”ã„ã‚‚ã®ã€ã¸"
date: "2025-01-10"
excerpt: "åˆæœŸã®ã‚·ãƒ³ãƒ—ãƒ«ãªLINEãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã‹ã‚‰ã€AIé§†å‹•ã®é«˜åº¦ãªå¯¾è©±ã‚·ã‚¹ãƒ†ãƒ ã¸ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’é©æ–°ã™ã‚‹é€²åŒ–ã®è¨˜éŒ²ã€‚"
category: "AI & Chatbot"
tags: ["LINE", "Chatbot", "AI", "GPT-4", "Node.js", "Evolution"]
demoUrl: "https://line.me/R/ti/p/@savvybot"
technologies: ["LINE Messaging API", "Node.js", "OpenAI GPT-4", "TypeScript", "Firebase", "Vercel"]
role: "Full Stack Developer"
duration: "é€²è¡Œä¸­ï¼ˆ2024/06ã€œï¼‰"
outcomes:
  - "åˆæœŸãƒãƒ¼ã‚¸ãƒ§ãƒ³å®Œæˆï¼ˆ2024/06ï¼‰ï¼šåŸºæœ¬çš„ãªå¿œç­”æ©Ÿèƒ½"
  - "AIçµ±åˆå®Œäº†ï¼ˆ2024/09ï¼‰ï¼šOpenAI GPT-3.5 Turboå°å…¥"
challenges:
  - "LINEã®åˆ¶ç´„ã®ä¸­ã§ã®é«˜åº¦ãªæ©Ÿèƒ½å®Ÿè£…"
  - "å¿œç­”é€Ÿåº¦ã¨AIå“è³ªã®ãƒãƒ©ãƒ³ã‚¹"
  - "ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä¿æŒã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®æœ€é©åŒ–"
learnings:
  - "LINEãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®ç‰¹æ€§ã‚’æ´»ã‹ã—ãŸè¨­è¨ˆ"
  - "AIå¿œç­”ã®æœ€é©åŒ–ã¨ã‚³ã‚¹ãƒˆç®¡ç†"
  - "ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã«åŸºã¥ãç¶™ç¶šçš„æ”¹å–„"
---

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆèƒŒæ™¯

2024å¹´6æœˆã€ã‚·ãƒ³ãƒ—ãƒ«ãªLINEå¿œç­”botã¨ã—ã¦SavvyBotã‚’é–‹ç™ºã—ã¾ã—ãŸã€‚å½“æ™‚ã¯LINEä¸Šã§ã®ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆé‹ç”¨ãŒç›®æ–°ã—ãã€åŸºæœ¬çš„ãªQ&Aæ©Ÿèƒ½ã§ååˆ†ã§ã—ãŸã€‚

### ãªãœé€²åŒ–ãŒå¿…è¦ãªã®ã‹

1. **å¸‚å ´ã®å¤‰åŒ–**
   - LINEãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã¯ä¸€èˆ¬åŒ–ã—ã€åŸºæœ¬æ©Ÿèƒ½ã ã‘ã§ã¯å·®åˆ¥åŒ–ã§ããªã„
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã‚ˆã‚Šè‡ªç„¶ã§è³¢ã„å¯¾è©±ã‚’æœŸå¾…ã™ã‚‹ã‚ˆã†ã«ãªã£ãŸ

2. **æŠ€è¡“ã®é€²æ­©**
   - GPT-4ãªã©é«˜åº¦ãªLLMãŒåˆ©ç”¨å¯èƒ½ã«
   - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†ã¨ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¿œç­”ãŒå®Ÿç¾å¯èƒ½ã«

3. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‹ãƒ¼ã‚º**
   - å˜ç´”ãªFAQå¿œç­”ã‹ã‚‰ã€ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ç†è§£ã—ãŸå¯¾è©±ã¸
   - ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºã•ã‚ŒãŸä½“é¨“ã®éœ€è¦

### é€²åŒ–ã®æ–¹å‘æ€§

**ã€Œã™ã”ã„ã‚‚ã®ã€ã®å®šç¾©**ï¼š
- ğŸ§  **è‡ªç„¶ãªå¯¾è©±**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ„å›³ã‚’ç†è§£ã—ã€æ–‡è„ˆã«æ²¿ã£ãŸå¿œç­”
- âš¡ **é«˜é€Ÿãƒ¬ã‚¹ãƒãƒ³ã‚¹**: 3ç§’ä»¥å†…ã®å¿œç­”æ™‚é–“
- ğŸ¯ **ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å¥½ã¿ã‚„å±¥æ­´ã‚’è¨˜æ†¶
- ğŸ”„ **ç¶™ç¶šå­¦ç¿’**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‹ã‚‰æ”¹å–„
- ğŸ¨ **ãƒªãƒƒãƒã‚³ãƒ³ãƒ†ãƒ³ãƒ„**: ãƒ†ã‚­ã‚¹ãƒˆã ã‘ã§ãªãã€ç”»åƒãƒ»ã‚«ãƒ«ãƒ¼ã‚»ãƒ«ãƒ»Flex Messageã®æ´»ç”¨

---

## æŠ€è¡“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®é€²åŒ–

### Version 1.0ï¼ˆ2024/06ï¼‰ï¼šåŸºæœ¬å®Ÿè£…

```
LINE Webhook
  â†“
Node.js Server (Express)
  â†“
Simple Rule-Based Response
  â†“
LINE Reply API
```

**åˆ¶é™äº‹é …**ï¼š
- å›ºå®šã•ã‚ŒãŸå¿œç­”ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã¿
- ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä¿æŒãªã—
- è¤‡é›‘ãªè³ªå•ã«å¯¾å¿œä¸å¯

### Version 2.0ï¼ˆ2024/09ï¼‰ï¼šAIçµ±åˆ

```
LINE Webhook
  â†“
Node.js Server (TypeScript)
  â†“
OpenAI GPT-3.5 Turbo
  â†“
Response Cache (Redis)
  â†“
LINE Reply API
```

**æ”¹å–„ç‚¹**ï¼š
- è‡ªç„¶è¨€èªç†è§£ã«ã‚ˆã‚‹æŸ”è»Ÿãªå¿œç­”
- åŸºæœ¬çš„ãªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä¿æŒ
- å¿œç­”å“è³ªã®å¤§å¹…å‘ä¸Š

### Version 3.0ï¼ˆ2025/01ã€œï¼‰ï¼šæ¬¡ä¸–ä»£ã‚·ã‚¹ãƒ†ãƒ  ğŸš€ é€²è¡Œä¸­

```
LINE Webhook
  â†“
Serverless Functions (Vercel)
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Orchestration Layer         â”‚
â”‚  - Intent Recognition       â”‚
â”‚  - Context Management       â”‚
â”‚  - Response Strategy        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AI Engine                   â”‚
â”‚  - OpenAI GPT-4             â”‚
â”‚  - Custom Fine-tuned Model  â”‚
â”‚  - Streaming Response       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Data Layer (Firebase)       â”‚
â”‚  - User Profiles            â”‚
â”‚  - Conversation History     â”‚
â”‚  - Learning Data            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
LINE Messaging API
  â†“
Rich Content Response
```

**ç›®æ¨™æ©Ÿèƒ½**ï¼š
- ãƒãƒ«ãƒã‚¿ãƒ¼ãƒ³å¯¾è©±ã®å®Œå…¨ãªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä¿æŒ
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«åŸºã¥ããƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚º
- ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¿œç­”ã«ã‚ˆã‚‹ä½“æ„Ÿé€Ÿåº¦å‘ä¸Š
- ãƒªãƒƒãƒã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å‹•çš„ç”Ÿæˆ

---

## å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º

### Phase 1: åŸºç›¤å¼·åŒ–ï¼ˆå®Œäº† âœ…ï¼‰

- [x] TypeScriptç§»è¡Œï¼ˆå‹å®‰å…¨æ€§å‘ä¸Šï¼‰
- [x] Vercel Serverlessç§»è¡Œï¼ˆã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ï¼‰
- [x] Firebaseçµ±åˆï¼ˆãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ï¼‰
- [x] OpenAI GPT-3.5 Turboçµ±åˆ

### Phase 2: AIé«˜åº¦åŒ–ï¼ˆé€²è¡Œä¸­ ğŸ”„ï¼‰

- [x] GPT-4ã¸ã®ç§»è¡Œ
- [ ] ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°æœ€é©åŒ–
  - [ ] ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®A/Bãƒ†ã‚¹ãƒˆ
  - [ ] Few-shot learningãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç¢ºç«‹
- [ ] ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ç®¡ç†
  - [ ] ä¼šè©±å±¥æ­´ã®è¦ç´„ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
  - [ ] é‡è¦æƒ…å ±ã®æŠ½å‡ºã¨ä¿æŒ
- [ ] ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¿œç­”å®Ÿè£…
  - [ ] LINE APIã®åˆ¶ç´„å†…ã§ã®ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¯¾å¿œ

### Phase 3: ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæœªç€æ‰‹ï¼‰

- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†
  - [ ] å¥½ã¿ãƒ»èˆˆå‘³ã®å­¦ç¿’
  - [ ] éå»ã®ä¼šè©±ã‹ã‚‰ã®ã‚¤ãƒ³ã‚µã‚¤ãƒˆæŠ½å‡º
- [ ] ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½
- [ ] å€‹åˆ¥åŒ–ã•ã‚ŒãŸå¿œç­”ã‚¹ã‚¿ã‚¤ãƒ«

### Phase 4: ãƒªãƒƒãƒã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼ˆæœªç€æ‰‹ï¼‰

- [ ] Flex Messageå‹•çš„ç”Ÿæˆ
- [ ] ç”»åƒç”Ÿæˆçµ±åˆï¼ˆDALL-E 3ï¼‰
- [ ] ã‚«ãƒ«ãƒ¼ã‚»ãƒ«ãƒ»ãƒœã‚¿ãƒ³ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ´»ç”¨
- [ ] Quick Replyã®è³¢ã„æ´»ç”¨

### Phase 5: å­¦ç¿’ãƒ»æœ€é©åŒ–ï¼ˆæœªç€æ‰‹ï¼‰

- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åé›†æ©Ÿèƒ½
- [ ] A/Bãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- [ ] å¿œç­”å“è³ªã®è‡ªå‹•è©•ä¾¡
- [ ] ã‚³ã‚¹ãƒˆæœ€é©åŒ–ï¼ˆãƒ¢ãƒ‡ãƒ«é¸æŠãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°ï¼‰

---

## é–‹ç™ºãƒ­ã‚°

### 2024-06-15: Version 1.0 ãƒªãƒªãƒ¼ã‚¹

ã‚·ãƒ³ãƒ—ãƒ«ãªLINEå¿œç­”botã¨ã—ã¦åˆæœŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ãƒªãƒªãƒ¼ã‚¹ã€‚

**å®Ÿè£…å†…å®¹**ï¼š
```javascript
// app.js
app.post('/webhook', (req, res) => {
  const events = req.body.events
  events.forEach(async (event) => {
    if (event.type === 'message' && event.message.type === 'text') {
      const userMessage = event.message.text
      const reply = getResponse(userMessage) // ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹

      await client.replyMessage(event.replyToken, {
        type: 'text',
        text: reply
      })
    }
  })
  res.status(200).end()
})
```

**èª²é¡Œ**ï¼š
- æŸ”è»Ÿæ€§ãŒãªãã€æƒ³å®šå¤–ã®è³ªå•ã«å¯¾å¿œã§ããªã„
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ãŒæ©Ÿæ¢°çš„

### 2024-09-10: Version 2.0 - AIçµ±åˆ

OpenAI GPT-3.5 Turboã‚’çµ±åˆã—ã€è‡ªç„¶ãªå¯¾è©±ã‚’å®Ÿç¾ã€‚

**å®Ÿè£…å†…å®¹**ï¼š
```typescript
// ai-handler.ts
import OpenAI from 'openai'

const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY
})

export async function generateResponse(
  userMessage: string,
  conversationHistory: Message[]
): Promise<string> {
  const messages = [
    {
      role: 'system',
      content: 'ã‚ãªãŸã¯è¦ªã—ã¿ã‚„ã™ãã€å½¹ç«‹ã¤ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚'
    },
    ...conversationHistory,
    {
      role: 'user',
      content: userMessage
    }
  ]

  const response = await openai.chat.completions.create({
    model: 'gpt-3.5-turbo',
    messages,
    temperature: 0.7,
    max_tokens: 500
  })

  return response.choices[0].message.content
}
```

**æˆæœ**ï¼š
- å¿œç­”å“è³ªãŒåŠ‡çš„ã«å‘ä¸Š
- ãƒ¦ãƒ¼ã‚¶ãƒ¼æº€è¶³åº¦ãŒä¸Šæ˜‡ï¼ˆä½“æ„Ÿï¼‰

**æ–°ãŸãªèª²é¡Œ**ï¼š
- å¿œç­”é€Ÿåº¦ãŒé…ã„ï¼ˆå¹³å‡5-7ç§’ï¼‰
- ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒä¼šè©±ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§ãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹
- ã‚³ã‚¹ãƒˆãŒäºˆæƒ³ä»¥ä¸Š

### 2025-01-10: Version 3.0 é–‹ç™ºé–‹å§‹

ã€Œã™ã”ã„ã‚‚ã®ã€ã‚’ç›®æŒ‡ã—ã€æ¬¡ä¸–ä»£ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®æ§‹ç¯‰ã‚’é–‹å§‹ã€‚

**GPT-4ç§»è¡Œ**ï¼š
```typescript
// ai-engine.ts
export async function generateAdvancedResponse(
  userMessage: string,
  userId: string
): Promise<AIResponse> {
  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å–å¾—
  const userProfile = await getUserProfile(userId)

  // ä¼šè©±å±¥æ­´å–å¾—ï¼ˆæœ€æ–°10ä»¶ + è¦ç´„ï¼‰
  const history = await getConversationHistory(userId, 10)
  const summarizedHistory = await summarizeHistory(history)

  // ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå‹•çš„ç”Ÿæˆ
  const systemPrompt = buildSystemPrompt(userProfile)

  const response = await openai.chat.completions.create({
    model: 'gpt-4',
    messages: [
      { role: 'system', content: systemPrompt },
      { role: 'assistant', content: summarizedHistory },
      ...history.slice(-3), // ç›´è¿‘3ä»¶ã¯ãã®ã¾ã¾
      { role: 'user', content: userMessage }
    ],
    temperature: 0.8,
    max_tokens: 800
  })

  return {
    text: response.choices[0].message.content,
    tokens: response.usage.total_tokens,
    model: 'gpt-4'
  }
}
```

**ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°**ï¼š
```typescript
function buildSystemPrompt(userProfile: UserProfile): string {
  return `
ã‚ãªãŸã¯SavvyBotã¨ã„ã†åå‰ã®è¦ªã—ã¿ã‚„ã™ã„AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚

ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ï¼š
- åå‰: ${userProfile.name || 'æœªè¨­å®š'}
- èˆˆå‘³: ${userProfile.interests.join(', ')}
- å¥½ã¿: ${userProfile.preferences}

å¿œç­”ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ï¼š
1. è¦ªã—ã¿ã‚„ã™ãã€ã§ã‚‚ç¤¼å„€æ­£ã—ã„å£èª¿
2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®èˆˆå‘³ã«é–¢é€£ã™ã‚‹æƒ…å ±ãŒã‚ã‚Œã°ã€ã•ã‚Šã’ãªãè¨€åŠ
3. ç°¡æ½”ã«ã€ã§ã‚‚æœ‰ç›Šãªæƒ…å ±ã‚’æä¾›
4. çµµæ–‡å­—ã‚’é©åº¦ã«ä½¿ç”¨ã—ã¦è¦ªã—ã¿ã‚„ã™ã•ã‚’æ¼”å‡º
5. é•·ã„å¿œç­”ã¯é¿ã‘ã€å¿…è¦ã«å¿œã˜ã¦ã€Œã‚‚ã£ã¨è©³ã—ãçŸ¥ã‚ŠãŸã„ã§ã™ã‹ï¼Ÿã€ã¨èã
`.trim()
}
```

---

## æŠ€è¡“çš„ãƒãƒ£ãƒ¬ãƒ³ã‚¸

### 1. LINEã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆåˆ¶ç´„

**å•é¡Œ**ï¼šLINEã¯å¿œç­”ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãŒå³ã—ãã€GPT-4ã®å¿œç­”ãŒé–“ã«åˆã‚ãªã„ã“ã¨ãŒã‚ã‚‹

**è§£æ±ºç­–**ï¼š
```typescript
// webhook-handler.ts
export async function handleMessage(event: MessageEvent) {
  // å³åº§ã«200 OKã‚’è¿”ã™
  res.status(200).end()

  // ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å‡¦ç†
  processMessageAsync(event).catch(console.error)
}

async function processMessageAsync(event: MessageEvent) {
  // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºï¼ˆTyping indicatorï¼‰
  await client.pushMessage(event.source.userId, {
    type: 'text',
    text: 'è€ƒãˆä¸­... ğŸ¤”'
  })

  // AIå¿œç­”ç”Ÿæˆ
  const response = await generateAdvancedResponse(
    event.message.text,
    event.source.userId
  )

  // çµæœã‚’é€ä¿¡
  await client.pushMessage(event.source.userId, {
    type: 'text',
    text: response.text
  })
}
```

### 2. ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†

**å•é¡Œ**ï¼šä¼šè©±å±¥æ­´ãŒé•·ããªã‚‹ã¨ãƒˆãƒ¼ã‚¯ãƒ³ã‚³ã‚¹ãƒˆãŒå¢—å¤§

**è§£æ±ºç­–**ï¼š
```typescript
// context-manager.ts
async function summarizeHistory(
  history: Message[]
): Promise<string> {
  if (history.length < 5) return ''

  const oldMessages = history.slice(0, -3) // ç›´è¿‘3ä»¶ä»¥å¤–
  const conversation = oldMessages
    .map(m => `${m.role}: ${m.content}`)
    .join('\n')

  const summary = await openai.chat.completions.create({
    model: 'gpt-3.5-turbo', // è¦ç´„ã¯å®‰ä¾¡ãªãƒ¢ãƒ‡ãƒ«
    messages: [
      {
        role: 'system',
        content: 'ä»¥ä¸‹ã®ä¼šè©±ã‚’ç°¡æ½”ã«è¦ç´„ã—ã¦ãã ã•ã„ã€‚'
      },
      {
        role: 'user',
        content: conversation
      }
    ],
    max_tokens: 150
  })

  return `[éå»ã®ä¼šè©±è¦ç´„]: ${summary.choices[0].message.content}`
}
```

### 3. ã‚³ã‚¹ãƒˆæœ€é©åŒ–

**æˆ¦ç•¥**ï¼š
- ã‚ˆãã‚ã‚‹è³ªå•ã¯äº‹å‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥
- è¦ç´„ã«ã¯GPT-3.5-turboä½¿ç”¨
- é‡è¦åº¦ã®ä½ã„å¿œç­”ã¯ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

```typescript
// cost-optimizer.ts
async function optimizedGenerate(
  userMessage: string,
  userId: string
): Promise<string> {
  // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒã‚§ãƒƒã‚¯
  const cached = await checkCache(userMessage)
  if (cached) return cached

  // æ„å›³åˆ†é¡
  const intent = await classifyIntent(userMessage)

  // ç°¡å˜ãªè³ªå•ã¯ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹
  if (intent.complexity === 'low') {
    return handleSimpleQuery(userMessage, intent)
  }

  // è¤‡é›‘ãªè³ªå•ã®ã¿GPT-4ä½¿ç”¨
  return generateAdvancedResponse(userMessage, userId)
}
```

---

## æˆæœæŒ‡æ¨™ï¼ˆKPIï¼‰

### ç¾åœ¨ã®çŠ¶æ³ï¼ˆVersion 2.0ï¼‰
- **å¹³å‡å¿œç­”æ™‚é–“**: 5.2ç§’
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼æº€è¶³åº¦**: æœªè¨ˆæ¸¬
- **æœˆé–“ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼**: ç´„50å
- **æœˆé–“API ã‚³ã‚¹ãƒˆ**: $15-20

### ç›®æ¨™ï¼ˆVersion 3.0ï¼‰
- **å¹³å‡å¿œç­”æ™‚é–“**: <3ç§’ âš¡
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼æº€è¶³åº¦**: >4.5/5.0 â­
- **æœˆé–“ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼**: 200å+
- **æœˆé–“API ã‚³ã‚¹ãƒˆ**: $30ä»¥ä¸‹ï¼ˆã‚³ã‚¹ãƒ‘å‘ä¸Šï¼‰
- **ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä¿æŒç‡**: >90%ï¼ˆ5ã‚¿ãƒ¼ãƒ³ä»¥ä¸Šã®ä¼šè©±ï¼‰

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### ç›´è¿‘ï¼ˆã€œ2025/02ï¼‰
- [ ] GPT-4ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæœ€é©åŒ–å®Œäº†
- [ ] ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¿œç­”ã®ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«åŸºæœ¬æ©Ÿèƒ½å®Ÿè£…

### ä¸­æœŸï¼ˆã€œ2025/04ï¼‰
- [ ] ãƒªãƒƒãƒã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç”Ÿæˆæ©Ÿèƒ½
- [ ] A/Bãƒ†ã‚¹ãƒˆåŸºç›¤æ§‹ç¯‰
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›®æ¨™é”æˆï¼ˆå¿œç­”æ™‚é–“ <3ç§’ï¼‰

### é•·æœŸï¼ˆã€œ2025/06ï¼‰
- [ ] ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ¢ãƒ‡ãƒ«ã®å°å…¥
- [ ] ãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ€ãƒ«å¯¾å¿œï¼ˆç”»åƒç†è§£ï¼‰
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°200åé”æˆ

---

## å‚è€ƒãƒªã‚½ãƒ¼ã‚¹

- [LINE Messaging API Documentation](https://developers.line.biz/ja/docs/messaging-api/)
- [OpenAI GPT-4 Best Practices](https://platform.openai.com/docs/guides/gpt-best-practices)
- [Vercel Serverless Functions](https://vercel.com/docs/functions/serverless-functions)
- [Firebase Realtime Database](https://firebase.google.com/docs/database)
